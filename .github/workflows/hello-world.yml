name: Lesson 2 - Syntax and Secrets

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

env:
  PROJECT_TYPE: "Zola Static Site" # 定義一個全域環境變數

jobs:
  prepare-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4 # 這是官方提供的 Action，用來把程式碼下載到虛擬機

      - name: Show Project Info
        run: |
          echo "正在處理的項目類型是: ${{ env.PROJECT_TYPE }}"
          echo "觸發此任務的人是: ${{ github.actor }}"

      # 模擬檢查 Secret 是否存在（這在部署伺服器時非常重要）
      - name: Check Deployment Secret
        if: github.event_name == 'push' # 只有在推送到分支時才檢查，PR 時跳過
        run: |
          if [ -n "${{ secrets.DEPLOY_TOKEN }}" ]; then
            echo "✅ 發現部署 Token，準備進行上傳..."
          else
            echo "⚠️ 未發現 DEPLOY_TOKEN，請檢查 GitHub Secrets 設定。"
          fi

      - name: Conditional Step for Pull Requests
        if: github.event_name == 'pull_request'
        run: echo "這是一個 PR，我們應該先執行測試，而不是部署。"
